<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-09-11 Wed 21:11 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Spiffing up those echo messages</title>
<meta name="author" content="Álvaro Ramírez" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<style type='text/css'>
         /* https://stackoverflow.com/questions/6370690/media-queries-how-to-target-desktop-tablet-and-mobile */

         body {
           font-size: 100%;
           max-width: 88ch;
           padding: 2ch;
           margin: auto;
           background-color: white;
         }

         .figure {
           padding: 0;
         }

         /* Table left border */
         .left {
           border-left: 1px solid #ccc;
         }

         .author {
           font-size: 1em;
           text-align: right;
           color: rgb(51, 51, 51);
           font-weight: bold;
           font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
           line-height: 1.15em;
         }

         .title {
           display: none; /* Title already included in header. Hide. */
           color: rgb(51, 51, 51);
           font-size: 1em;
           text-align: right;
         }

         .org-src-container {
           background-color: #fbfbfb;
           border-radius: 10px;
         }

         #contact-header {
           width: 100%;
         }

         #contact-right {
           text-align: right;
         }

         #contact-left {
           text-align: left;
         }

         #content {
         }

         blockquote {
           overflow: auto;
         }

         b, strong {
          font-weight: bold;
         }

         pre {
           border: none;
           box-shadow: none;
         }

         pre.src {
           overflow: auto;
         }

         /* Hide sh/bash/Emacs Lisp overlay */
         pre.src:hover:before {
           display: none;
         }

         p, .org-ol, .org-ul, .org-left {
           color: #3A4145;
           font-family: 'Lucida Grande', 'Lucida Sans Unicode',
               'Lucida Sans', Geneva, Verdana, sans-serif;
           font-size: 1em;
           font-style: normal;
           font-weight: 300;
           letter-spacing: 0.01rem;
           line-height: 1.5em;
           text-rendering: optimizelegibility;
         }

         h1, h2, h3, h4, h5, #preamble {
           color: #2E2E2E;
           font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
           line-height: 1.15em;
         }

         h1 {
           font-size: 2em;
         }

         h2 {
           font-size: 1.6em;
           letter-spacing: -0.02em;
           margin-bottom: 0px;
           text-indent: -3px;
         }

         h3 {
           font-size: 1.2em;
         }

         #preamble {
           text-align: right;
         }

         .timestamp {
          color: #a9a9a9;
          display: block;
          font-family: 'Lucida Grande', 'Lucida Sans Unicode',
              'Lucida Sans', Geneva, Verdana, sans-serif;
          font-size: 0.5em;
          font-style: normal;
          font-weight: 300;
          line-height: 1em;
         }

         .modified-timestamp {
           color: #D3d3d3;
           font-family: 'Lucida Grande', 'Lucida Sans Unicode',
               'Lucida Sans', Geneva, Verdana, sans-serif;
           font-size: 0.8em;
           text-rendering: optimizelegibility;
         }

         a {
          color: #4183C4;
          text-decoration: none;
         }

         a:visited {
          background-color: #4183C4;
         }

         .outline-2 {
         }

         .example {
           white-space: pre-wrap;
           background-color: #f8ffe1;
         }
       </style>

       <!-- Start of Goat Code -->
       <script data-goatcounter="https://xenodium.goatcounter.com/count"
               async src="//gc.zgo.at/count.js">
       </script>
       <!-- End of Goat Code -->
</head>
<body>
<div id="preamble" class="status">

<table id='contact-header'>
  <tr>
    <td id='contact-left'>
      <a style='color:rgb(51, 51, 51);' href='/'>index</a>
      <a style='color:rgb(51, 51, 51);' href='/rss.xml'>rss</a>
    </td>
    <td id='contact-right'>
      <a rel='me' href='https://indieweb.social/@xenodium'>mastodon</a>
      <a href='https://twitter.com/xenodium'>twitter</a>
      <a href='http://github.com/xenodium'>github</a>
      <a href='http://uk.linkedin.com/in/xenodium'>linkedin</a>
      <a href='mailto:me@xenodium.com'>email</a>
    </td>
  </tr>
  <tr>
    <td style='text-align: left;'>
      <a href='https://plainorg.com'>
        <img style='padding-top: 5px; max-width: 4ch;' src='https://plainorg.com/favicon.ico'/>
      </a>
      <a href='https://apps.apple.com/app/id1671420139'>
        <img style='padding-top: 5px; max-width: 4ch;' src='../images/scratch-a-minimal-scratch-area/scratch_icon.png'/>
      </a>
      <a href='https://flathabits.com'>
        <img style='padding-top: 5px; max-width: 4ch;' src='https://flathabits.com/favicon.ico'/>
      </a>
      <a href='https://apps.apple.com/app/id6480411697'>
        <img style='padding-top: 5px; max-width: 4ch;' src='../images/fresh-eyes-now-on-the-app-store/fresh_eyes_icon.png'/>
      </a>
    </td>
    <td style='padding-top:10px;'>
      <span class='author'>Álvaro Ramírez</span><br/>
      <a style='color:rgb(51, 51, 51);' href='https://github.com/sponsors/xenodium'>sponsor</a>
    </td>
  </tr>
</table>
</div>
<div id="content" class="content">
<h1 class="title">Álvaro Ramírez</h1>
<div id="outline-container-spiffing-up-those-echo-messages" class="outline-2">
<h2 id="spiffing-up-those-echo-messages"><span class="timestamp-wrapper"><span class="timestamp">11 September 2024</span></span> Spiffing up those echo messages</h2>
<div class="outline-text-2" id="text-spiffing-up-those-echo-messages">
<p>
Well-ingrained into every Emacs user is the echo area, a one-stop shop to receive any kind of message from the editor, located at the bottom of the frame. Posting messages to this area from elisp couldn't be simpler:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #183691;">"Hello world"</span>)
</pre>
</div>


<div id="orga0b7afa" class="figure">
<p><img src="../images/spiffing-up-those-echo-messages/svg-hello-world.gif" alt="svg-hello-world.gif" width="75%" />
</p>
</div>

<p>
If we want to get a little fancier, we can propertize the text to add some styling.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(message (propertize <span style="color: #183691;">"hello "</span> 'face '(<span style="color: #a71d5d;">:foreground</span> <span style="color: #183691;">"#C3E88D"</span>))
         (propertize <span style="color: #183691;">"world"</span> 'face '(<span style="color: #a71d5d;">:foreground</span> <span style="color: #183691;">"#FF5370"</span>)))
</pre>
</div>


<div id="org99a70b1" class="figure">
<p><img src="../images/spiffing-up-those-echo-messages/svg-hello-world-colors.gif" alt="svg-hello-world-colors.gif" width="75%" />
</p>
</div>

<p>
With this in mind, I set out to add a tiny command to <a href="https://github.com/xenodium/ready-player">ready-player</a>.
</p>

<p>
I wanted the ability to ask what's on without switching to another buffer. The echo area is perfect for that. It should display track title, artist, and album.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(message (concat <span style="color: #183691;">"Ahead "</span> <span style="color: #969896;">;; </span><span style="color: #969896;">title</span>
                 (propertize <span style="color: #183691;">"Wire "</span> 'face '(<span style="color: #a71d5d;">:foreground</span> <span style="color: #183691;">"#C3E88D"</span>)) <span style="color: #969896;">;; </span><span style="color: #969896;">artist</span>
                 (propertize <span style="color: #183691;">"The Ideal Copy"</span> 'face '(<span style="color: #a71d5d;">:foreground</span> <span style="color: #183691;">"#FF5370"</span>)))) <span style="color: #969896;">;; </span><span style="color: #969896;">album</span>
</pre>
</div>


<div id="orgc7ad63b" class="figure">
<p><img src="../images/spiffing-up-those-echo-messages/svg-ready-player-colors.gif" alt="svg-ready-player-colors.gif" width="75%" />
</p>
</div>


<p>
This kinda works, but I wasn't convinced with the styling. Maybe I need multi-line?
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(message (concat <span style="color: #183691;">"Ahead\n"</span> <span style="color: #969896;">;; </span><span style="color: #969896;">title</span>
                 (propertize <span style="color: #183691;">"Wire\n"</span> 'face '(<span style="color: #a71d5d;">:foreground</span> <span style="color: #183691;">"#C3E88D"</span>)) <span style="color: #969896;">;; </span><span style="color: #969896;">artist</span>
                 (propertize <span style="color: #183691;">"The Ideal Copy"</span> 'face '(<span style="color: #a71d5d;">:foreground</span> <span style="color: #183691;">"#FF5370"</span>)))) <span style="color: #969896;">;; </span><span style="color: #969896;">album</span>
</pre>
</div>


<div id="org0218213" class="figure">
<p><img src="../images/spiffing-up-those-echo-messages/svg-ready-player-colors-multiline.gif" alt="svg-ready-player-colors-multiline.gif" width="75%" />
</p>
</div>


<p>
I felt something was missing. If I could just add the album artwork as a thumbnail&#x2026; The ideal layout would maybe look something like:
</p>

<div class="org-src-container">
<pre class="src src-nil">+-------+
|       | Ahead
| image | Wire
|       | The Ideal Copy
+-------+
</pre>
</div>

<p>
While the text-everywhere nature of Emacs buffers has many advantages, building more involved layouts can have its challenges. But hey, for that simple read-only message we're aiming at, we can certainly get creative without too much trouble. You see, Emacs has native svg support, so we can craft our fancy layout in elisp and tell Emacs to render it for us.
</p>

<p>
While I'm a noob at doing anything in svg from Emacs, adding an image and three labels, really isn't that difficult.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(message
 (<span style="color: #a71d5d;">let*</span> ((image-width 90)
        (image-height 90)
        (text-height 25)
        (svg (svg-create (frame-pixel-width) image-height)))
   (svg-embed svg <span style="color: #183691;">"path/to/thumbnail.png"</span>
              <span style="color: #183691;">"image/png"</span> nil
              <span style="color: #a71d5d;">:x</span> 0 <span style="color: #a71d5d;">:y</span> 0 <span style="color: #a71d5d;">:width</span> image-width <span style="color: #a71d5d;">:height</span> image-height)
   (svg-text svg <span style="color: #183691;">"Ahead"</span>
             <span style="color: #a71d5d;">:x</span> (+ image-width 10) <span style="color: #a71d5d;">:y</span> text-height
             <span style="color: #a71d5d;">:fill</span> (face-attribute 'default <span style="color: #a71d5d;">:foreground</span>))
   (svg-text svg <span style="color: #183691;">"Wire"</span>
             <span style="color: #a71d5d;">:x</span> (+ image-width 10) <span style="color: #a71d5d;">:y</span> (* 2 text-height)
             <span style="color: #a71d5d;">:fill</span> <span style="color: #183691;">"#C3E88D"</span>)
   (svg-text svg <span style="color: #183691;">"The Ideal Copy"</span> <span style="color: #a71d5d;">:x</span> (+ image-width 10) <span style="color: #a71d5d;">:y</span> (* 3 text-height)
             <span style="color: #a71d5d;">:fill</span> <span style="color: #183691;">"#FF5370"</span>)
   (<span style="color: #a71d5d;">with-temp-buffer</span>
     (svg-insert-image svg)
     (buffer-string))))
</pre>
</div>

<p>
The code is fairly self-explanatory. While there may be an even simpler way (please lemme know), I used a temporary buffer to embed the svg in the propertized text prior to feeding to the handy <code>message</code> function.
</p>

<p>
&#x2026;and with that, we get a richer display of the current track.
</p>


<div id="org288e40a" class="figure">
<p><img src="../images/spiffing-up-those-echo-messages/svg-ready-player-colors-image.gif" alt="svg-ready-player-colors-image.gif" width="75%" />
</p>
</div>

<p>
While I haven't experimented with other ways of creating multi-column layouts in Emacs (including images), <a href="https://indieweb.social/@xenodium">I'd love to know</a> if there's anything else available besides svg.
</p>
</div>
<div id="outline-container-org14fe7c0" class="outline-3">
<h3 id="org14fe7c0">Enjoying these tips? Using one of my Emacs packages?</h3>
<div class="outline-text-3" id="text-org14fe7c0">
<p>
Help make them sustainable. Consider <a href="https://github.com/sponsors/xenodium">supporting</a> this work.
</p>
</div>
</div>
</div>
</div>
</body>
</html>
