#+TITLE: Intro a dwim-shell-command
#+AUTHOR: Álvaro Ramírez
#+STARTUP: noinlineimages

* Executing shell commands

Emacs has plenty of wonderful ways of executing shell commands.

I'm a fan of =shell-command=, =async-shell-command=, and =dired-do-shell-command=.

I wanted to ~combine~ some of the ~strengths in each function~.

*** add to wish list

- Combine favourite strengths from:
   =shell-command=
   =async-shell-command=
   =dired-do-shell-command=

* /M-!/ =shell-command=

** Get image EXIF metadata
Let's open [[file:demo1/burger.png]] and get metadata using =exiftool= shell command.
#+begin_src sh
exiftool burger.png
#+end_src
*** My wish list

- No manual =M-n= to insert buffer file name.
- When done, display/focus output buffer.
- q quits/kills output buffer.


** Get image EXIF metadata (reuse command history)

Let's open [[file:demo2/wasabi.png]] and reuse command from history.

#+begin_src sh
exiftool burger.png
#+end_src
*** My wish list

- Reusable history (no mods needed).


** Convert to jpg

Let's convert [[file:demo4/chilly.png]] to jpg.

#+begin_src sh
  convert chilly.png chilly.jpg
#+end_src
*** My wish list

- Automatically show me the created file.


** Run command with colour output

Let's run a shell command that may output some colours.

#+begin_src sh
  neofetch
#+end_src
*** My wish list

- Render output colours.

* /M-&/ =async-shell-command=

** Long-lived commands

Let's run a command that takes a little time to execute.

#+begin_src sh
  ping -c 10 gnu.org
#+end_src
*** add to wish list

- Show me process is active while in background.
- Automatically focus output buffer when done.
- Keep output buffer nearby in stack.
- q quits/kills output buffer.


** Multiple long-lived commands

Let's run simultaneous shell commands

#+begin_src sh
  ping gnu.org
#+end_src

*** add to wish list

- Don't ask to start a new buffer (just do it).
- Don't ask to kill the buffer process (just do it).

* /M-!/ =dired-do-shell-command=

Similar to =shell-command=, but can operate on [[https://www.gnu.org/software/emacs/manual/html_node/emacs/Dired.html][dired]] files.

** Convert a file to jpg

Let's convert a file in [[file:demo5]] to jpg.

#+begin_src sh
  convert `?` `?`.jpg
#+end_src

*** add to wish list

- Change file extension completely (don't append).


** Convert marked files to jpg

Let's convert marked files in [[file:demo6]] to jpg.

#+begin_src sh
  convert `?` `?`.jpg
#+end_src

*** add to wish list

- Change file extension completely (not append).


** Convert region files to jpg

Let's convert multiple files in [[file:demo6]] to jpg.

#+begin_src sh
  convert `?` `?`.jpg
#+end_src

*** add to wish list

- Allow region also.

* dwim-shell-command

What is [[https://en.wikipedia.org/wiki/DWIM][DWIM]]?

  It stands for _do what I mean_.

I want a shell command function that does what ✨I✨ mean.

*** add to wish list

- Combine favourite strengths from:
   =shell-command=
   =async-shell-command=
   =dired-do-shell-command=
- No manual =M-n= to insert buffer file name.
- When done, display/focus output buffer.
- q quits/kills output buffer.
- Reusable history (no mods needed).
- Automatically show me the created file.
- Render output colours.
- Show me process is active while in background.
- Automatically focus output buffer when done.
- Keep output buffer nearby in stack.
- Don't ask to start a new buffer (just do it).
- Don't ask to kill the buffer process (just do it).

* Credits
** Images
[[https://www.openclipart.org/detail/340312/fukubukuro][Fukubukuro]]
[[https://www.openclipart.org/detail/340307/hamburger-in-a-wraper][Hamburger in a Wraper]]
[[https://www.openclipart.org/detail/339958/reina-de-corazones-vectorizado][Reina de corazones (Vectorizado)]]
[[https://www.openclipart.org/detail/339338/a-pair-of-boots][A pair of boots]]
[[https://www.openclipart.org/detail/340256/wasabi][Wasabi]]
[[https://www.openclipart.org/detail/337526/one-taco][One Taco]]
[[https://www.openclipart.org/detail/320454/ramen-8][Ramen (#8)]]
[[https://www.openclipart.org/detail/281268/hot-sauce][Hot Sauce]]

* Unused
#+begin_src emacs-lisp :lexical no :results none
    ;; (director-run
    ;;  :version 1
    ;;  :steps '((:call shell-command)
    ;;           (:type "ls images/burger.png")
    ;;           (:type [return]))
    ;;  :typing-style 'human
    ;;  :delay-between-steps 1)


    (director-run
     :version 1
     :steps '((:call beginning-of-buffer)
              (:call isearch-forward)
              (:type "demo1")
              (:type [return])
              (:type [return]))
     :typing-style 'human
     :delay-between-steps 1)




                  ;; (:call beginning-of-buffer)
      ;;            (:call iseach-forward)
      ;;            (:type "demo1")
      ;;            (:type [return])
      ;;            (:type [return])
    ;;               (:type "exiftool burger.png")
#+end_src
